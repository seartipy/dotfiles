#! /usr/bin/env bash

CURRENT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

{

source "${CURRENT_DIR}/scripts/utils.sh"
source "${CURRENT_DIR}/installers/bootstrap.sh"
source "${CURRENT_DIR}/installers/utils.sh"
source "${CURRENT_DIR}/installers/mods.sh"

source "${CURRENT_DIR}/installers/mac.sh"
source "${CURRENT_DIR}/installers/ubuntu.sh"

# installer

installer() {
    opts=(essential dotfiles "$@")

    slog "Installing..."

    mods_setup ${opts[@]}
    mods_install ${opts[@]}
    mods_cleanup ${opts[@]}

    if [ -n "$ZSH" ]; then
        echo "Set zsh as your default shell(in case this fails, run `chsh -s /bin/zsh` manually later)"
        chsh -s /bin/zsh
    fi

    post_installer_check

    slog "Installation done!"
}

# diagnostics

post_installer_check() {
    post_installer_setup

    [ -n "$ESSENTIAL" ] && essential_check
    [ -n "$DOTFILES" ] && dotfiles_check
    check_mods
}

source "${CURRENT_DIR}/scripts/bootstrap.sh"

}
